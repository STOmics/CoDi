# Spatial Single-cell Integration (SSI)

This script performs Spatial Single-cell Integration (SSI) for integrating single-cell cell type and spatially resolved datasets.

## Table of Contents

- [Introduction](#introduction)
- [Requirements](#requirements)
- [Usage](#usage)
- [Parameters](#parameters)
- [Output](#output)
- [Visualization](#visualization)
- [License](#license)

## Introduction

Spatial Single-cell Integration (SSI) is a script designed to integrate single-cell and spatially resolved datasets using various distance metrics. The script utilizes marker genes, precalculated inverse covariance matrices, and parallel processing to assign cell types to spatially resolved cells.

## Requirements

- Python 3.x
- Required Python libraries can be installed using:

  ```bash
  pip install numpy pandas matplotlib scanpy seaborn tqdm
  ```

## Usage

```bash
python ssi_script.py --sc_path <single_cell_dataset.h5ad> --st_path <spatial_dataset.h5ad> [additional parameters]
```

## Parameters

- `--sc_path`: Path to the single-cell reference dataset (in h5ad format).
- `--st_path`: Path to the spatially resolved dataset (in h5ad format).
- `-a` or `--annotation`: Annotation label for cell types (default: "cell_subclass").
- `-d` or `--distance`: Distance metric used to measure the distance between a point and a distribution of points (default: "KLD", choices: {"mahalanobis", "KLD", "wasserstein"}).
- `--num_markers`: Number of marker genes (default: 100).
- `--n_jobs`: Number of jobs to run in parallel. -1 means using all available processors (default: -1).

Example:

```bash
python ssi_script.py --sc_path data/single_cell_dataset.h5ad --st_path data/spatial_dataset.h5ad -a celltype -d KLD --num_markers 150 --n_jobs 4
```

## Output

The script generates an output h5ad file containing the annotated spatial dataset (`<spatial_dataset>_ssi.h5ad`) and CSV also contating the cell type annotation in the second column and cell IDs in the first column (`<spatial_dataset>_ssi.csv`).. Additionally, a histogram of confidence scores and a confidence histogram plot are saved.

## Benchmark

The list of available paired datasets is available in `run_all.sh`.
This library can calculate retention of the marker genes in spatialy resolved datasets comparing to scRNA cell types. CSV generated by SSI can be direct input to `scripts/metrics.py'. The command lines for our datasets are available in `scripts/metrics.sh'. Its output contains CSV where first row is for non-promiscuete (unique marker genes) and second is for top 100 marker genes.
The second benchmark uses scRNA downsampled datasets created using `scripts/create_synthetic.py'. `scripts/benchmark.py` can run SSI for pairs of original and subsampled dataset and generate metrics for it. It receives configuration containing paths in input JSON file (e.g. `test/config_4k_adult_brain.json` and `test/config_40k_visium.json`). The current benchmark is only for SSI, it should be adjusted to support other tools. When benchmark for several tools is available it can be cisualized using 'scripts/viz_benchmark.py`.


## Visualization

The script includes visualization options, such as plotting spatial scatterplots and histograms, to aid in understanding the integration results. Uncomment and customize the visualization section in the script according to your requirements.

## License

This project is licensed under the [MIT License](LICENSE).

